<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المساعد الصوتي</title>
    <style>
        /* CSS: لتصميم الواجهة العصرية والشخصية السائلة */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap');

        :root {
            --background-color: #ffffff;
            --main-color: #000000;
        }

        body {
            background-color: var(--background-color);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: 'Cairo', sans-serif;
            overflow: hidden;
        }

        .title {
            position: absolute;
            top: 20px;
            color: #ccc;
            font-size: 24px;
        }

        #venom-container {
            width: 300px;
            height: 300px;
            position: relative;
            filter: url('#goo'); /* تطبيق فلتر الـ SVG */
        }

        .blob {
            position: absolute;
            background: var(--main-color);
            border-radius: 50%;
            mix-blend-mode: screen;
        }

        /* حالة الحركة الافتراضية (هادئة) */
        #venom-container.idle .blob {
            animation: move 15s infinite alternate;
        }
        
        /* حالة الحركة عند التحدث */
        #venom-container.speaking .blob {
            animation: speak 0.8s infinite alternate;
        }
        
        .blob:nth-child(1) { width: 150px; height: 150px; top: 75px; left: 75px; animation-delay: 0s; }
        .blob:nth-child(2) { width: 80px; height: 80px; top: 50px; left: 140px; animation-delay: -2s; }
        .blob:nth-child(3) { width: 100px; height: 100px; top: 130px; left: 60px; animation-delay: -4s; }
        .blob:nth-child(4) { width: 70px; height: 70px; top: 150px; left: 160px; animation-delay: -6s; }

        @keyframes move {
            0%   { transform: translate(0, 0) scale(1); }
            25%  { transform: translate(30px, -25px) scale(1.05); }
            50%  { transform: translate(-20px, 30px) scale(0.95); }
            75%  { transform: translate(-30px, -20px) scale(1.02); }
            100% { transform: translate(0, 0) scale(1); }
        }

        @keyframes speak {
            0%   { transform: scale(1.0, 1.0); }
            50%  { transform: scale(1.2, 1.25); }
            100% { transform: scale(1.0, 1.0); }
        }

        .controls {
            position: absolute;
            bottom: 50px;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        #talkButton {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background-color: var(--main-color);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.2s ease, background-color 0.2s ease;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2);
        }

        #talkButton:hover {
            transform: scale(1.1);
        }

        #talkButton.listening {
            background-color: #d32f2f; /* أحمر عند الاستماع */
        }
        
        #talkButton svg {
            width: 40px;
            height: 40px;
            fill: var(--background-color);
        }

        #stopButton {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #ccc;
            background-color: transparent;
            color: #ccc;
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s ease;
        }

        #stopButton:hover {
            border-color: var(--main-color);
            color: var(--main-color);
        }
    </style>
</head>
<body>
    <h1 class="title">V E N O M</h1>

    <!-- الشخصية المتحركة -->
    <div id="venom-container" class="idle">
        <div class="blob"></div>
        <div class="blob"></div>
        <div class="blob"></div>
        <div class="blob"></div>
    </div>
    
    <!-- أزرار التحكم -->
    <div class="controls">
        <button id="stopButton" title="إيقاف المحادثة">X</button>
        <button id="talkButton" title="اضغط للتحدث">
            <svg viewBox="0 0 24 24">
                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.49 6-3.31 6-6.72h-1.7z"/>
            </svg>
        </button>
    </div>

    <!-- فلتر SVG لإعطاء التأثير السائل -->
    <svg style="position:absolute; width:0; height:0;">
        <defs>
            <filter id="goo">
                <feGaussianBlur in="SourceGraphic" stdDeviation="12" result="blur" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo" />
                <feBlend in="SourceGraphic" in2="goo" />
            </filter>
        </defs>
    </svg>

    <script>
        // JavaScript: لإدارة منطق المحادثة والحركة
        const talkButton = document.getElementById('talkButton');
        const stopButton = document.getElementById('stopButton');
        const venomContainer = document.getElementById('venom-container');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = SpeechRecognition ? new SpeechRecognition() : null;
        const synthesis = window.speechSynthesis;
        
        if (!recognition) {
            alert("عذراً، متصفحك لا يدعم خاصية التعرف على الصوت.");
            talkButton.disabled = true;
        } else {
            recognition.lang = 'ar-SA';
            recognition.continuous = false;
            recognition.interimResults = false;
        }

        let isListening = false;

        const speak = (text) => {
            if (synthesis.speaking) {
                return;
            }
            const utterance = new SpeechSynthesisUtterance(text);
            const voices = synthesis.getVoices();
            const arabicVoice = voices.find(voice => voice.lang.startsWith('ar'));
            if (arabicVoice) utterance.voice = arabicVoice;
            
            utterance.onstart = () => {
                isListening = false;
                talkButton.classList.remove('listening');
                venomContainer.classList.remove('idle');
                venomContainer.classList.add('speaking');
            };

            utterance.onend = () => {
                venomContainer.classList.remove('speaking');
                venomContainer.classList.add('idle');
            };

            synthesis.speak(utterance);
        };

        const startListening = () => {
            if (isListening) return;
            isListening = true;
            talkButton.classList.add('listening');
            recognition.start();
        };

        const stopAll = () => {
            isListening = false;
            talkButton.classList.remove('listening');
            if(recognition) recognition.stop();
            if(synthesis) synthesis.cancel();
            venomContainer.classList.remove('speaking');
            venomContainer.classList.add('idle');
        };

        if(recognition) {
            talkButton.addEventListener('click', startListening);
            stopButton.addEventListener('click', stopAll);

            recognition.onend = () => {
                isListening = false;
                talkButton.classList.remove('listening');
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.toLowerCase().trim();
                handleQuery(transcript);
            };

            recognition.onerror = (event) => {
                console.error("خطأ في التعرف على الصوت:", event.error);
                isListening = false;
                talkButton.classList.remove('listening');
            };
        }

        const handleQuery = (query) => {
            let response = "لم أفهم تماماً. هل يمكنك إعادة صياغة سؤالك؟";

            const responses = {
                "مرحبا": ["أهلاً بك!", "مرحباً، كيف أخدمك؟", "يا أهلاً، أنا في الاستماع."],
                "كيف حالك": ["أنا بخير، مجرد مجموعة من الأكواد تعمل بانسجام.", "بأفضل حال، شكراً لسؤالك.", "أنا في حالة ممتازة، وجاهز للمساعدة."],
                "ما هو اسمك": ["ليس لدي اسم، ولكن يمكنك مناداتي بالمساعد.", "أنا كيان رقمي، يمكنك أن تناديني فينوم.", "الأسماء للبشر، أنا مجرد برنامج."],
                "اضحك": ["ها ها ها ها.", "هه هه هه.", "ضحكة رقمية: هاهاها."],
                "شكرا": ["العفو!", "على الرحب والسعة.", "لا شكر على واجب."]
            };

            for (const key in responses) {
                if (query.includes(key)) {
                    const possibleResponses = responses[key];
                    response = possibleResponses[Math.floor(Math.random() * possibleResponses.length)];
                    break;
                }
            }
            
            speak(response);
        };
        
        // تحميل الأصوات المتاحة في المتصفح
        synthesis.onvoiceschanged = () => {
            console.log("الأصوات المتاحة:", synthesis.getVoices());
        };
    </script>
</body>
</html>
